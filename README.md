# Sheep Simulator

## Ограничения

- На больших скоростях овцы игнорируют коллизии друг с другом.
- UI'ные слайдеры двигаются на wasd, после изменения скорости симуляции нужно нажать на свободную область вне слайдера, чтобы сбросить с него фокус.
- Максимальное зафиксированное потребление памяти при запуске в редакторе и population = 500.000 -- 10 GiB. Крайне не рекоммендуется запускать на машинах с меньшим объёмом памяти.

## Возможные улучшения производительности

### Процессорное время

По данным, полученным с помощью профилирования, большая часть нагрузки на процессор приходится на обработку физики. Чтобы уменьшить нагрузку, можно попробовать использовать 2D-коллайдеры на 3D-объектах.
Это может помочь, так как расчёт двухмерных коллизий должен занимать меньше времени, чем расчёт трёхмерных.

Caveats:

- При попытке переноса было обнаружено, что 2D-физика по-другому обрабатывает коллизии, из-за чего две овцы могут столкнуться лбами и застрять на долгое время.
  Для качественной работы симуляции в 2D-пространстве придётся добавить продвинутую логику навигации.

### Потребление памяти

Профилирование памяти показало, что большую часть памяти в приложении занимают объекты ParticleSystem.
По этому поводу можно сделать две вещи:

- Сократить количество используемых ParticleSystems.
- Перенести проект на Universal Rendering Pipeline, а вместо ParticleSystems использовать VisualEffects.

Caveats:

- Попытка внедрения URP показала, что VisualEffects не имеют простого аналога ивента `OnParticleSystemStopped`, что не позволяет освобождать место в пуле эффектов и переиспользовать их.
- При попытке запуска проекта с URP и большим количеством овец на Windows, возникает GPU Timeout и симуляция крашится вместе с Unity. Нужно искать способы снизить нагрузку на GPU.
