# Sheep Simulator

Упрощённый трёхмерный симулятор поведения животного на поле.

```
           __  _
       .-.'  `; `-._  __  _
      (_,         .-:'  `; `-._
    ,'o"(        (_,           )
   (__,-'      ,'o"(            )>
      (       (__,-'            )
       `-'._.--._(             )
          |||  |||`-'._.--._.-'
                     |||  |||
```

## Управление симуляцией

- `w, a, s, d` -- перемещение по полю;
- `r, f` -- изменение масштаба;
- `q, e` -- изменение угла наклона камеры;
- `y, u` -- изменение скорости симуляции;
- Зажатие `Shift` замедляет движение и ускоряет изменение скорости симуляции;
- `space` -- поставить симуляцию на паузу, повторное нажатие устанавливает скорость в `1.0`.

## Ограничения

- На больших скоростях и вне области видимости камеры овцы игнорируют коллизии друг с другом.
- При запуске из редактора скорость симуляции ограничена значением 100 (ограничение движка).
- UI'ные слайдеры двигаются на wasd, после изменения скорости симуляции нужно нажать на свободную область вне слайдера, чтобы сбросить с него фокус.
- При загрузке из файла данные о положении объектов не проверяются на соответствие размеру поля.
- Очень долго загружается на больших нагрузках.

## Возможные дальнейшие улучшения производительности

### Процессорное время

По данным, полученным с помощью профилирования, большая часть нагрузки на процессор приходится на обработку физики. Чтобы уменьшить нагрузку, можно попробовать использовать 2D-коллайдеры на 3D-объектах.
Это может помочь, так как расчёт двухмерных коллизий должен занимать меньше времени, чем расчёт трёхмерных.

Caveats:

- При попытке переноса было обнаружено, что 2D-физика по-другому обрабатывает коллизии, из-за чего две овцы могут столкнуться лбами и застрять на долгое время.
  Для качественной работы симуляции в 2D-пространстве придётся добавить продвинутую логику навигации.

### Потребление памяти

Профилирование памяти показало, что большую часть памяти в приложении занимают объекты ParticleSystem.
По этому поводу можно сделать две вещи:

- Ограничить количество используемых ParticleSystems.
- Перенести проект на Universal Rendering Pipeline, а вместо ParticleSystems использовать VisualEffects.

Caveats:

- Попытка внедрения URP показала, что VisualEffects не имеют простого аналога ивента `OnParticleSystemStopped`, что не позволяет освобождать место в пуле эффектов и переиспользовать их.
- При попытке запуска проекта с URP и большим количеством овец на Windows, возникает GPU Timeout и симуляция крашится вместе с Unity. Нужно искать способы снизить нагрузку на GPU.

## Credits

- Код: Igor Kislitsyn;
- ASCII-иллюстрация:  Bob Allison;
- Текстуры: Lennart Demes via [cc0textures](https://cc0textures.com/).
